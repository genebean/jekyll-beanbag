<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>My journey to securing sensitive data in Puppet code - The Comfy Seat</title>
<meta name="description" content="Dealing with secrets and sensitive data in Puppet is daunting, right? Nope, not at all. Let me show you how to do it. I’ve wrapped my head around the options available and want to share my journey in hopes of saving you from a few trials and tribulations. Just interested in the end result? Feel free to scroll down to the last section fittingly entitled The final product.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="The Comfy Seat">
<meta property="og:title" content="My journey to securing sensitive data in Puppet code">
<meta property="og:url" content="http://localhost:4000/jekyll-beanbag/protecting-sensitive-data-in-puppet-code/">


  <meta property="og:description" content="Dealing with secrets and sensitive data in Puppet is daunting, right? Nope, not at all. Let me show you how to do it. I’ve wrapped my head around the options available and want to share my journey in hopes of saving you from a few trials and tribulations. Just interested in the end result? Feel free to scroll down to the last section fittingly entitled The final product.">







  <meta property="article:published_time" content="2018-08-15T14:50:40-04:00">






<link rel="canonical" href="http://localhost:4000/jekyll-beanbag/protecting-sensitive-data-in-puppet-code/">













<!-- end _includes/seo.html -->


<link href="/jekyll-beanbag/feed.xml" type="application/atom+xml" rel="alternate" title="The Comfy Seat Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/jekyll-beanbag/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/jekyll-beanbag/"><img src="/jekyll-beanbag/assets/images/the-comfy-seat.png" alt=""></a>
        
        <a class="site-title" href="/jekyll-beanbag/">The Comfy Seat</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/jekyll-beanbag/posts/">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/jekyll-beanbag/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/jekyll-beanbag/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/jekyll-beanbag/about/">About</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Gene Liverman</h3>
    
    
      <p class="author__bio" itemprop="description">
        My awesome biography constrained to a sentence or two goes here.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Georgia, USA</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/genebean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://twitter.com/technicalissues" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://app.vagrantup.com/genebean" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Vagrant Boxes</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="My journey to securing sensitive data in Puppet code">
    <meta itemprop="description" content="Dealing with secrets and sensitive data in Puppet is daunting, right? Nope, not at all. Let me show you how to do it. I’ve wrapped my head around the options available and want to share my journey in hopes of saving you from a few trials and tribulations. Just interested in the end result? Feel free to scroll down to the last section fittingly entitled The final product.">
    <meta itemprop="datePublished" content="August 15, 2018">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">My journey to securing sensitive data in Puppet code
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  13 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Dealing with secrets and sensitive data in Puppet is daunting, right? Nope, not at all. Let me show you how to do it. I’ve wrapped my head around the options available and want to share my journey in hopes of saving you from a few trials and tribulations. Just interested in the end result? Feel free to scroll down to the last section fittingly entitled <a href="#finalproduct"><em>The final product</em></a>.</p>

<h2 id="preface">Preface</h2>

<p>Puppet’s InfraCore team manages engineering’s core infrastructure from hardware to the actual host configuration of running applications and services. The InfraCore team was already utilizing <a href="https://github.com/voxpupuli/hiera-eyaml">hiera-eyaml</a> in their control repo when I joined them last April. That control repo is used by all of SRE at Puppet so this meant other teams could take advantage of having secrets, like passwords and AWS keys, versioned in git without fear of exposure to everyone with access to the repo. That’s a big deal since we open up our repositories to the entire company by default.</p>

<h3 id="infracores-hiera-eyaml-setup">InfraCore’s hiera-eyaml setup</h3>

<p>The maintainers of hiera-eyaml, <a href="https://voxpupuli.org/">Vox Pupuli</a>, describe one way to set it up in its <a href="https://github.com/voxpupuli/hiera-eyaml#setup">readme</a>. We bootstrapped our eyaml setup by placing the keys on our <a href="https://puppet.com/docs/pe/2018.1/overview/pe_architecture_overview.html#pe-architecture-the-master-of-masters-mom">master of masters</a> (MoM) and manually running <code class="highlighter-rouge">puppetserver gem install hiera-eyaml</code>. Once the MoM was bootstrapped, everything else was managed by our control repo. To do this we added <a href="https://forge.puppet.com/puppetlabs/puppetserver_gem">puppetlabs-puppetserver_gem</a> to our Puppetfile and then added the code below to the profile used by our MoM and compile masters:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">file</span> <span class="p">{</span>
  <span class="k">default</span><span class="p">:</span>
    <span class="py">ensure</span> <span class="p">=&gt;</span> <span class="n">file</span><span class="p">,</span>
    <span class="py">owner</span>  <span class="p">=&gt;</span> <span class="s1">'root'</span><span class="p">,</span>
    <span class="py">group</span>  <span class="p">=&gt;</span> <span class="s1">'root'</span><span class="p">,</span>
  <span class="p">;</span>
  <span class="s1">'/etc/puppetlabs/puppet/eyaml'</span><span class="p">:</span>
    <span class="py">ensure</span> <span class="p">=&gt;</span> <span class="n">directory</span><span class="p">,</span>
    <span class="py">mode</span>   <span class="p">=&gt;</span> <span class="s1">'0755'</span><span class="p">,</span>
  <span class="p">;</span>
  <span class="s1">'/etc/puppetlabs/puppet/eyaml/private_key.pkcs7.pem'</span><span class="p">:</span>
    <span class="py">group</span>   <span class="p">=&gt;</span> <span class="s1">'pe-puppet'</span><span class="p">,</span>
    <span class="py">mode</span>    <span class="p">=&gt;</span> <span class="s1">'0440'</span><span class="p">,</span>
    <span class="py">content</span> <span class="p">=&gt;</span> <span class="nf">lookup</span><span class="p">(</span><span class="s1">'profile::pe::master::eyaml_private_key'</span><span class="p">),</span>
  <span class="p">;</span>
  <span class="s1">'/etc/puppetlabs/puppet/eyaml/public_key.pkcs7.pem'</span><span class="p">:</span>
    <span class="py">mode</span>   <span class="p">=&gt;</span> <span class="s1">'0444'</span><span class="p">,</span>
    <span class="py">source</span> <span class="p">=&gt;</span> <span class="s1">'puppet:///modules/profile/pe/master/eyaml_public_key.pkcs7.pem'</span><span class="p">,</span>
  <span class="p">;</span>
<span class="p">}</span>

<span class="n">package</span> <span class="p">{</span> <span class="s1">'hiera-eyaml puppetserver_gem'</span><span class="p">:</span>
  <span class="py">ensure</span>   <span class="p">=&gt;</span> <span class="s1">'2.1.0'</span><span class="p">,</span>
  <span class="py">name</span>     <span class="p">=&gt;</span> <span class="s1">'hiera-eyaml'</span><span class="p">,</span>
  <span class="py">provider</span> <span class="p">=&gt;</span> <span class="s1">'puppetserver_gem'</span><span class="p">,</span>
  <span class="kp">notify</span>   <span class="p">=&gt;</span> <span class="nc">Service</span><span class="p">[</span><span class="s1">'pe-puppetserver'</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This took care of installing the needed gem and distributing the keys since all the compile masters get their catalogs from the MoM.</p>

<h3 id="deploying-secrets">Deploying secrets</h3>

<p>We have a Confluence page to help anyone who wants to store sensitive data in our control repo. It contains a copy of our eyaml public key and explains how they can use it:</p>

<ol>
  <li>Install the hiera-eyaml gem via <code class="highlighter-rouge">gem install hiera-eyaml</code>
</li>
  <li>Place the public key in <code class="highlighter-rouge">~/.eyaml/key.pub</code>
</li>
  <li>Create <code class="highlighter-rouge">~/.eyaml/config.yaml</code> and add a line like <code class="highlighter-rouge">pkcs7_public_key: '/Users/&lt;your username&gt;/.eyaml/key.pub'</code> to it</li>
</ol>

<p>They can then encrypt their string, file, or password like shown in the example below. Note that:</p>

<ul>
  <li>
<code class="highlighter-rouge">-f</code> encrypts a file.</li>
  <li>
<code class="highlighter-rouge">-s</code> encrypts a string.</li>
  <li>
<code class="highlighter-rouge">-p</code> prompts for a password (or other string) and encrypts it.</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eyaml encrypt [-f|-s] $my_string_or_file

eyaml encrypt -p
Enter password: 
</code></pre></div></div>

<p>This generates a single-line and a multi-line encrypted version of the crypto-text that you can place in the relevant yaml file.</p>

<h2 id="the-journey">The journey</h2>

<p>My journey began a couple of weeks ago when I was working on converting a <a href="https://fog.io/about/getting_started.html"><code class="highlighter-rouge">~/.fog</code> file</a> used by our Jenkins servers from a flat file to one generated by a Puppet profile. I created a new profile with parameters for each setting. The values that were not sensitive were set with sane defaults while the sensitive values were pulled from Hiera via <a href="https://puppet.com/docs/hiera/3.3/puppet.html#automatic-parameter-lookup">automatic parameter lookup</a> where they are stored as eyaml-encrypted strings. In the body of the profile I created a local variable with a hash that mirrored the structure of the fog file. I then created a file resource that converted the hash to yaml as the content. It looked something like this:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">profile::jenkins::agent::fog</span> <span class="p">(</span>
  <span class="nc">String</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>           <span class="nv">$default_some_password</span><span class="p">,</span>
  <span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="m">1</span><span class="p">]</span> <span class="nv">$default_some_array</span>    <span class="err">=</span> <span class="p">[</span> <span class="s1">'item1'</span><span class="p">,</span> <span class="s1">'item2'</span> <span class="p">],</span>
  <span class="nc">String</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>           <span class="nv">$default_some_username</span> <span class="err">=</span> <span class="s1">'jdoe'</span><span class="p">,</span>
  <span class="p">)</span> <span class="p">{</span>
  <span class="nv">$fog_hash</span> <span class="err">=</span> <span class="p">{</span>
    <span class="s1">'default'</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="s1">'some_array'</span>    <span class="p">=&gt;</span> <span class="nv">$default_some_array</span><span class="p">,</span>
      <span class="s1">'some_username'</span> <span class="p">=&gt;</span> <span class="nv">$default_some_username</span><span class="p">,</span>
      <span class="s1">'some_password'</span> <span class="p">=&gt;</span> <span class="nv">$default_some_password</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nv">$agent_home</span> <span class="err">=</span> <span class="s1">'/var/lib/jenkins'</span>

  <span class="n">file</span> <span class="p">{</span> <span class="s2">"</span><span class="nv">${agent_home}</span><span class="s2">/.fog"</span><span class="p">:</span>
    <span class="py">ensure</span>  <span class="p">=&gt;</span> <span class="n">file</span><span class="p">,</span>
    <span class="py">mode</span>    <span class="p">=&gt;</span> <span class="s1">'0640'</span><span class="p">,</span>
    <span class="py">owner</span>   <span class="p">=&gt;</span> <span class="s1">'jenkins'</span><span class="p">,</span>
    <span class="py">group</span>   <span class="p">=&gt;</span> <span class="s1">'jenkins'</span><span class="p">,</span>
    <span class="py">content</span> <span class="p">=&gt;</span> <span class="nf">to_yaml</span><span class="p">(</span><span class="nv">$fog_hash</span><span class="p">),</span>
    <span class="kp">require</span> <span class="p">=&gt;</span> <span class="nc">User</span><span class="p">[</span><span class="s1">'jenkins'</span><span class="p">],</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>That code generates this file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">default</span><span class="pi">:</span>
  <span class="na">some_array</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">item1</span>
  <span class="pi">-</span> <span class="s">item2</span>
  <span class="na">some_username</span><span class="pi">:</span> <span class="s">jdoe</span>
  <span class="na">some_password</span><span class="pi">:</span> <span class="s">pa$$w0rd</span>
</code></pre></div></div>

<p>I tested this new profile out locally and all looked good so I ran it on one of the targeted nodes. Nothing about the file changed, which was what I expected, so I created a pull request and a little later it was merged. Success!</p>

<p>Coincidentally, right as I finished the code above one of our devs hit me up about adding a new section to the file. I told them “no problem!” since facilitating that process was part of why I was reworking the file’s management anyhow. So… I created a branch, made the change, and tested it on the same node as before.</p>

<h3 id="oh-crap-passwords-are-showing-up-in-diffs">Oh crap! Passwords are showing up in diffs…</h3>

<p>When I ran <code class="highlighter-rouge">puppet agent -t --noop -E new_fog_section</code> two things happened:</p>

<ol>
  <li>I saw the new section being added to the file (as expected)</li>
  <li>I <strong>saw</strong> the new section, including the passwords, right there on my monitor which also meant it was in the report sent back to the PE console.</li>
</ol>

<p>The whole point of encrypting the password in Hiera was to keep it out of plain text in places it shouldn’t be. The current process was obviously failing at this so I figured it was time to learn how to put this thing I’d heard people talk about called “the <a href="https://puppet.com/docs/puppet/5.5/lang_data_sensitive.html">Sensitive</a> data type” to use.</p>

<h3 id="help">HELP!</h3>

<p>I read everything I could find on this subject but was still confused, so I posted the message below to an internal mailing list:</p>

<blockquote>
  <p>Subject: Sensitive and Class params from Hiera</p>

  <p>How can I use the sensitive data type to keep strings that are encrypted via eyaml in Hiera from being displayed in the diff of a file? The use case here is for the params in a manifest that do not have defaults assigned to them.</p>
</blockquote>

<p>Later that same day I got two tips that set the path for the rest of my journey:</p>

<ol>
  <li>One of our solutions consultants suggested I have a look at Ben Ford’s <a href="https://forge.puppet.com/binford2k/node_encrypt">binford2k-node_encrypt</a> module.</li>
  <li>A long-time professional services engineer (PSE) expanded on that by telling me that
    <ul>
      <li>in Puppet 5.5.0 we added the ability to cast a parameter looked up via automatic parameter lookup to Sensitive by way of <code class="highlighter-rouge">lookup_options</code>. (<a href="https://tickets.puppetlabs.com/browse/PUP-7675">PUP-7675</a>)</li>
      <li>when building a file using the content attribute, you can’t restrict the diff to hide Sensitive types and show non-Sensitive types so I’d need to not show the diff at all. To do that I’d need to add <code class="highlighter-rouge">show_diff =&gt; false</code> to the file resource.</li>
      <li>if I want to hide the Sensitive values from the catalog and from PuppetDB then I’d need to use the node_encrypt module mentioned earlier.</li>
    </ul>
  </li>
</ol>

<h3 id="stumbling-around">Stumbling around</h3>

<p>This was all great info and sounded like what I was looking for but I was also not quite getting it yet. In particular, I didn’t understand how to do the casting and I had a total memory lapse when it comes to how <a href="https://puppet.com/docs/hiera/3.3/puppet.html#automatic-parameter-lookup">automatic parameter lookup</a> works. With regards to the latter, I got it in my head somehow that parameters were only automatically looked up if defaults were not supplied so I was baffled when setting a parameter to something like <code class="highlighter-rouge">Sensitive[String[1]] $bar = Sensitive(lookup('profile::foo:bar'))</code> complained that <code class="highlighter-rouge">parameter 'bar' expects a Sensitive[String] value, got String</code>. That’s where the casting via <code class="highlighter-rouge">lookup_options</code> comes in.</p>

<h3 id="lookup_options-to-the-rescue">lookup_options to the rescue</h3>

<p>One of our other PSEs was kind enough to hop in chat with me and helped me understand the flaw in how I was doing the casting. It turns out that since the values are in Hiera I needed to do the casting in Hiera too. The result was me going into the Hiera file where the sensitive values were stored and adding this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">lookup_options</span><span class="pi">:</span>
  <span class="s1">'</span><span class="s">^profile::jenkins::agent::fog::default_some_password:</span>
    <span class="s">convert_to:</span><span class="nv"> </span><span class="s">'Sensitive'</span>
  <span class="s">'^profile::jenkins::agent::fog::second_special_param'</span><span class="pi">:</span>
    <span class="na">convert_to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sensitive'</span>
  <span class="s1">'</span><span class="s">^profile::jenkins::agent::fog::another_param_thats_encrypted'</span><span class="pi">:</span>
    <span class="na">convert_to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sensitive'</span>
  <span class="s1">'</span><span class="s">^profile::jenkins::agent::fog::p4_special_param'</span><span class="pi">:</span>
    <span class="na">convert_to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sensitive'</span>
  <span class="s1">'</span><span class="s">^profile::jenkins::agent::fog::special_param_no_5'</span><span class="pi">:</span>
    <span class="na">convert_to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sensitive'</span>
  <span class="s1">'</span><span class="s">^profile::jenkins::agent::fog::special_param_no_6'</span><span class="pi">:</span>
    <span class="na">convert_to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sensitive'</span>
  <span class="s1">'</span><span class="s">^profile::jenkins::agent::fog::special_param_no_7'</span><span class="pi">:</span>
    <span class="na">convert_to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sensitive'</span>
</code></pre></div></div>

<p>Back in the manifest I adjusted it to look something like this:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">profile::jenkins::agent::fog</span> <span class="p">(</span>
  <span class="nc">Sensitive</span><span class="p">[</span><span class="nc">String</span><span class="p">[</span><span class="m">1</span><span class="p">]]</span> <span class="nv">$default_some_password</span><span class="p">,</span>
  <span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="m">1</span><span class="p">]</span>  <span class="nv">$default_some_array</span>    <span class="err">=</span> <span class="p">[</span> <span class="s1">'item1'</span><span class="p">,</span> <span class="s1">'item2'</span> <span class="p">],</span>
  <span class="nc">String</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>            <span class="nv">$default_some_username</span> <span class="err">=</span> <span class="s1">'jdoe'</span><span class="p">,</span>
  <span class="c"># several more parameters omitted here
</span>  <span class="p">)</span> <span class="p">{</span>
  <span class="nv">$fog_hash</span> <span class="err">=</span> <span class="p">{</span>
    <span class="s1">'default'</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="s1">'some_array'</span>    <span class="p">=&gt;</span> <span class="nv">$default_some_array</span><span class="p">,</span>
      <span class="s1">'some_username'</span> <span class="p">=&gt;</span> <span class="nv">$default_some_username</span><span class="p">,</span>
      <span class="s1">'some_password'</span> <span class="p">=&gt;</span> <span class="nv">$default_some_password</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c"># file resource unchanged below here
</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="regex-for-the-win">Regex for the win</h3>

<p>Notice some redundancy in those Hiera entries? Yeah, me too. Along the way there was mention that you could use a regex with <code class="highlighter-rouge">lookup_options</code> so I hunted around and found <a href="https://puppet.com/docs/puppet/5.5/hiera_merging.html#use-a-regular-expression-in-lookup-options">a docs page</a> that showed me how this worked. Thanks to that info I refactored the parameter names to always start with “sensitive_” and replaced the entries above with this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">lookup_options</span><span class="pi">:</span>
  <span class="s1">'</span><span class="s">^profile::jenkins::agent::fog::sensitive_.*'</span><span class="pi">:</span>
    <span class="na">convert_to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sensitive'</span>
</code></pre></div></div>

<p>Great. Now any param in that profile that starts with <code class="highlighter-rouge">sensitive_</code> with an entry in this particular yaml file will be cast to Sensitive… but what about parameters saved in other files?</p>

<h3 id="going-global">Going global</h3>

<p>Our hiera.yaml follows the has <code class="highlighter-rouge">common.yaml</code> as the lowest level. With that in mind I took the <code class="highlighter-rouge">lookup_options</code> block and moved it there. I then refactored it to cover any parameter in any profile that begins with <code class="highlighter-rouge">sensitive_</code> by expanding the regex:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">lookup_options</span><span class="pi">:</span>
  <span class="s1">'</span><span class="s">^profile::.+::sensitive_\w+$'</span><span class="pi">:</span>
    <span class="na">convert_to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sensitive'</span>
</code></pre></div></div>

<h3 id="implementing-node_encrypt">Implementing node_encrypt</h3>

<p>At this stage I was quite happy with how things were coming along but still wanted to implement <code class="highlighter-rouge">node_encrypt</code> before declaring victory. To that end, I added the latest versions of <a href="https://forge.puppet.com/binford2k/node_encrypt"><code class="highlighter-rouge">binford2k-node_encrypt</code></a> and <a href="https://forge.puppet.com/puppetlabs/puppet_authorization"><code class="highlighter-rouge">puppetlabs-puppet_authorization</code></a> from <a href="https://forge.puppet.com/">Puppet Forge</a> to our Puppetfile and replaced my file resource with a <code class="highlighter-rouge">node_encrypt::file</code> resource. Doing so just required prefixing <code class="highlighter-rouge">file</code> with <code class="highlighter-rouge">node_encrypt::</code>. The updated resource looked like this:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">node_encrypt::file</span> <span class="p">{</span> <span class="s2">"</span><span class="nv">${agent_home}</span><span class="s2">/.fog"</span><span class="p">:</span>
  <span class="py">ensure</span>  <span class="p">=&gt;</span> <span class="n">file</span><span class="p">,</span>
  <span class="py">mode</span>    <span class="p">=&gt;</span> <span class="s1">'0640'</span><span class="p">,</span>
  <span class="py">owner</span>   <span class="p">=&gt;</span> <span class="s1">'jenkins'</span><span class="p">,</span>
  <span class="py">group</span>   <span class="p">=&gt;</span> <span class="s1">'jenkins'</span><span class="p">,</span>
  <span class="py">content</span> <span class="p">=&gt;</span> <span class="nf">to_yaml</span><span class="p">(</span><span class="nv">$fog_hash</span><span class="p">),</span>
  <span class="kp">require</span> <span class="p">=&gt;</span> <span class="nc">User</span><span class="p">[</span><span class="s1">'jenkins'</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I then modified the profile for our Puppet masters again (the one used by the MoM and compile masters) and added these two lines:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">include</span> <span class="nc">node_encrypt::certificates</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">node_encrypt</code> <a href="https://forge.puppet.com/binford2k/node_encrypt#automatically-distributing-certificates-to-compile-masters">readme</a> has this to say about the above line:</p>

<blockquote>
  <p>The <code class="highlighter-rouge">node_encrypt::certificates</code> class can synchronize certificates across your infrastructure so that encryption works from all compile masters.</p>
</blockquote>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Puppet_authorization</span><span class="p">::</span><span class="nc">Rule</span> <span class="p">&lt;|</span> <span class="p">|&gt;</span> <span class="p">~&gt;</span> <span class="nc">Service</span><span class="p">[</span><span class="s1">'pe-puppetserver'</span><span class="p">]</span>
</code></pre></div></div>

<p>This line ensures that authorization rules like the one added by <code class="highlighter-rouge">node_encrypt::certificates</code> get applied right away by <a href="https://puppet.com/docs/puppet/5.5/lang_collectors.html">collecting them all</a> and then notifying the pe-puppetserver service when needed.</p>

<h4 id="our-mom-has-an-alias">Our MoM has an alias…</h4>

<p>Like many people we have set up an alias for our certificate authority (and most everything else) so that configurations don’t have to change when a server is replaced. This means we need to override a parameter on the <code class="highlighter-rouge">node_encrypt::certificates</code> class on our MoM but nowhere else. To do this I added this line to its node-specific Hiera file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="s">node_encrypt::certificates::ca_server</span><span class="pi">:</span> <span class="s2">"</span><span class="s">%{facts.fqdn}"</span>
</code></pre></div></div>

<h3 id="testing-time">Testing time</h3>

<p>With the code completed it’s time to make sure tests still pass. We use <a href="https://github.com/dylanratcliffe/onceover">Onceover</a> to test all pull requests to our control repo. The <code class="highlighter-rouge">node_encrypt</code> module does some unique things like access a node’s public Puppet certificates during catalog compilation. This is awesome for protecting sensitive data but caused me quite a bit of consternation when trying to figure out how to get tests to pass again. Fortunately, I work with some awesome people who are always willing to lend a hand. I reached out to <a href="https://www.linkedin.com/in/dylan-ratcliffe-0b93301a">Dylan Ratcliffe</a> (the author of Onceover) and <a href="https://www.linkedin.com/in/ben-ford-061b344">Ben Ford</a> (the author of <code class="highlighter-rouge">node_encrypt</code>) to see if they could help get me unstuck and, sure enough, they did. In the end they helped me write some code in <code class="highlighter-rouge">spec/onceover.yaml</code> to mock the internal functions and prevent the catalog compilation from reading the file system during testing:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">functions</span><span class="pi">:</span>
  <span class="na">node_encrypt</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">rvalue</span>
    <span class="na">returns</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-----BEGIN</span><span class="nv"> </span><span class="s">PKCS7-----</span><span class="se">\n</span><span class="s">encrypted"</span>

<span class="na">before</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">require_relative</span><span class="nv"> </span><span class="s">'../../etc/puppetlabs/code/environments/production/modules/node_encrypt/lib/puppet_x/binford2k/node_encrypt.rb'"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">Puppet_X::Binford2k::NodeEncrypt.stubs(:encrypt).with('foobar','testhost.example.com').returns('encrypted')"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">Puppet_X::Binford2k::NodeEncrypt.stubs(:decrypt).with('-----BEGIN</span><span class="nv"> </span><span class="s">PKCS7-----</span><span class="se">\n</span><span class="s">encrypted').returns('decrypted')"</span>
</code></pre></div></div>

<h3 id="tests-pass-lets-roll">Tests pass, let’s roll</h3>

<p>Everything <em>seemed</em> to be good so after a couple of code review approvals I applied the environment associated with this code to our MoM so that <code class="highlighter-rouge">node_encrypt::certificates</code> could do its magic. Next I dipped into our tool bag and used <a href="https://puppet.com/products/puppet-bolt">bolt</a> to do the same on all the compile masters:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># bolt gets updated often...
$ gem update bolt
$ bolt command run 'sudo -i puppet agent --onetime --no-daemonize --no-usecacheonfailure --no-splay --verbose -E sensitive_and_node_encrypt' --nodes @/Users/&lt;my username&gt;/Downloads/prod-compilers.txt
</code></pre></div></div>

<p>With the certificates distributed, I did a <code class="highlighter-rouge">--noop</code> run in this environment followed by a real run on the same server that was used for testing earlier. Everything looked good so we merged the pull request and let it roll out to all the places fog is used.</p>

<h3 id="annnnd-i-broke-it">Annnnd I broke it</h3>

<p>As it turns out I missed something in my first implementation of the Sensitive data type… I didn’t realize I had to apply the unwrap function to each parameter when using it inside of a hash. This caused every place that should look like <code class="highlighter-rouge">some_password: pa$$w0rd</code> to look like this instead:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> some_password: !ruby/object:Puppet::Pops::Types::PSensitiveType::Sensitive
    value: pa$$w0rd
</code></pre></div></div>

<p>Not surprisingly, this broke fog. I could have reverted the change and triggered a Puppet run on all the Jenkins agents but our developers were okay with letting it sit until I fixed the issue. To get rid of all the extra text I just needed to go back and surround each of the sensitive values in the hash with <code class="highlighter-rouge">unwrap()</code> like so:</p>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$fog_hash</span> <span class="err">=</span> <span class="p">{</span>
  <span class="s1">'default'</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="s1">'some_array'</span>    <span class="p">=&gt;</span> <span class="nv">$default_some_array</span><span class="p">,</span>
    <span class="s1">'some_username'</span> <span class="p">=&gt;</span> <span class="nv">$default_some_username</span><span class="p">,</span>
    <span class="s1">'some_password'</span> <span class="p">=&gt;</span> <span class="nf">unwrap</span><span class="p">(</span><span class="nv">$sensitive_default_some_password</span><span class="p">),</span> <span class="c"># function added here
</span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With the fix in place we stepped through the PR process and then merged it to fix the other servers.</p>

<p><a name="finalproduct"></a></p>

<h2 id="the-final-product">The final product</h2>

<p>The final product is a setup that:</p>

<ul>
  <li>has secrets stored as encrypted strings in Hiera via <a href="https://github.com/voxpupuli/hiera-eyaml">hiera-eyaml</a>
</li>
  <li>automatically casts all Hiera values that start with <code class="highlighter-rouge">profile::</code> and end with <code class="highlighter-rouge">sensitive_*</code> to <a href="https://puppet.com/docs/puppet/5.5/lang_data_sensitive.html">Sensitive</a>
</li>
  <li>allows utilizing the <a href="https://forge.puppet.com/binford2k/node_encrypt">binford2k-node_encrypt</a> module to encrypt secrets in a node’s catalog and prevent them from being disclosed in reports and diffs</li>
</ul>

<p>This is done by:</p>

<ol>
  <li>Deploying hiera-eyaml to the master of masters manually as described in the backend’s readme file</li>
  <li>Using <a href="https://forge.puppet.com/puppetlabs/puppetserver_gem">puppetserver_gem</a> and some file resources to deploy the hiera-eyaml gem and the needed keys to the compile masters</li>
  <li>Adding a <code class="highlighter-rouge">lookup_options</code> entry to <code class="highlighter-rouge">common.yaml</code> that utilizes a regex matcher</li>
  <li>Refactoring parameters on profiles that access secrets in Hiera to enforce the Sensitive data type</li>
  <li>Adding code to the master of masters and compilers to make the public certs from nodes available when compiling catalogs</li>
  <li>Add a collector to the same servers to ensure authorization rules like the one added by <code class="highlighter-rouge">node_encrypt::certificates</code> trigger a restart of the pe-puppetserver service</li>
  <li>Switch from a <code class="highlighter-rouge">file</code> resource to a <code class="highlighter-rouge">node_encrypt::file</code> resource for sensitive files</li>
</ol>

<p>Examples of each of these are below:</p>

<h3 id="profile-for-masters">Profile for masters</h3>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">include</span> <span class="nc">node_encrypt::certificates</span>  

<span class="nc">Puppet_authorization</span><span class="p">::</span><span class="nc">Rule</span> <span class="p">&lt;|</span> <span class="p">|&gt;</span> <span class="p">~&gt;</span> <span class="nc">Service</span><span class="p">[</span><span class="s1">'pe-puppetserver'</span><span class="p">]</span>

<span class="n">file</span> <span class="p">{</span>
  <span class="k">default</span><span class="p">:</span>
    <span class="py">ensure</span> <span class="p">=&gt;</span> <span class="n">file</span><span class="p">,</span>
    <span class="py">owner</span>  <span class="p">=&gt;</span> <span class="s1">'root'</span><span class="p">,</span>
    <span class="py">group</span>  <span class="p">=&gt;</span> <span class="s1">'root'</span><span class="p">,</span>
  <span class="p">;</span>
  <span class="s1">'/etc/puppetlabs/puppet/eyaml'</span><span class="p">:</span>
    <span class="py">ensure</span> <span class="p">=&gt;</span> <span class="n">directory</span><span class="p">,</span>
    <span class="py">mode</span>   <span class="p">=&gt;</span> <span class="s1">'0755'</span><span class="p">,</span>
  <span class="p">;</span>
  <span class="s1">'/etc/puppetlabs/puppet/eyaml/private_key.pkcs7.pem'</span><span class="p">:</span>
    <span class="py">group</span>   <span class="p">=&gt;</span> <span class="s1">'pe-puppet'</span><span class="p">,</span>
    <span class="py">mode</span>    <span class="p">=&gt;</span> <span class="s1">'0440'</span><span class="p">,</span>
    <span class="py">content</span> <span class="p">=&gt;</span> <span class="nf">lookup</span><span class="p">(</span><span class="s1">'profile::pe::master::eyaml_private_key'</span><span class="p">),</span>
  <span class="p">;</span>
  <span class="s1">'/etc/puppetlabs/puppet/eyaml/public_key.pkcs7.pem'</span><span class="p">:</span>
    <span class="py">mode</span>   <span class="p">=&gt;</span> <span class="s1">'0444'</span><span class="p">,</span>
    <span class="py">source</span> <span class="p">=&gt;</span> <span class="s1">'puppet:///modules/profile/pe/master/eyaml_public_key.pkcs7.pem'</span><span class="p">,</span>
  <span class="p">;</span>
<span class="p">}</span>

<span class="n">package</span> <span class="p">{</span> <span class="s1">'hiera-eyaml puppetserver_gem'</span><span class="p">:</span>
  <span class="py">ensure</span>   <span class="p">=&gt;</span> <span class="s1">'2.1.0'</span><span class="p">,</span>
  <span class="py">name</span>     <span class="p">=&gt;</span> <span class="s1">'hiera-eyaml'</span><span class="p">,</span>
  <span class="py">provider</span> <span class="p">=&gt;</span> <span class="s1">'puppetserver_gem'</span><span class="p">,</span>
  <span class="kp">notify</span>   <span class="p">=&gt;</span> <span class="nc">Service</span><span class="p">[</span><span class="s1">'pe-puppetserver'</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="hiera-node-file-for-master-of-masters">Hiera node file for master of masters</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="s">node_encrypt::certificates::ca_server</span><span class="pi">:</span> <span class="s2">"</span><span class="s">%{facts.fqdn}"</span>  
</code></pre></div></div>

<h3 id="hiera-commonyaml">Hiera common.yaml</h3>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">lookup_options</span><span class="pi">:</span>
  <span class="s1">'</span><span class="s">^profile::.+::sensitive_\w+$'</span><span class="pi">:</span>
    <span class="na">convert_to</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Sensitive'</span>
</code></pre></div></div>

<h3 id="profile-with-sensitive-params">Profile with sensitive params</h3>

<div class="language-puppet highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">profile::jenkins::agent::fog</span> <span class="p">(</span>
  <span class="nc">Sensitive</span><span class="p">[</span><span class="nc">String</span><span class="p">[</span><span class="m">1</span><span class="p">]]</span> <span class="nv">$sensitive_default_some_password</span><span class="p">,</span>
  <span class="nc">Array</span><span class="p">[</span><span class="nc">String</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="m">1</span><span class="p">]</span>  <span class="nv">$default_some_array</span>    <span class="err">=</span> <span class="p">[</span>
    <span class="s1">'item1'</span><span class="p">,</span>
    <span class="s1">'item2'</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="nc">String</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>            <span class="nv">$default_some_username</span> <span class="err">=</span> <span class="s1">'jdoe'</span><span class="p">,</span>
  <span class="c"># several more parameters omitted here
</span>  <span class="p">)</span> <span class="p">{</span>
  <span class="nv">$fog_hash</span> <span class="err">=</span> <span class="p">{</span>
    <span class="s1">'default'</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="s1">'some_array'</span>    <span class="p">=&gt;</span> <span class="nv">$default_some_array</span><span class="p">,</span>
      <span class="s1">'some_username'</span> <span class="p">=&gt;</span> <span class="nv">$default_some_username</span><span class="p">,</span>
      <span class="s1">'some_password'</span> <span class="p">=&gt;</span> <span class="nf">unwrap</span><span class="p">(</span><span class="nv">$sensitive_default_some_password</span><span class="p">),</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">node_encrypt::file</span> <span class="p">{</span> <span class="s2">"</span><span class="nv">${agent_home}</span><span class="s2">/.fog"</span><span class="p">:</span>  
    <span class="py">ensure</span>  <span class="p">=&gt;</span> <span class="n">file</span><span class="p">,</span>
    <span class="py">mode</span>    <span class="p">=&gt;</span> <span class="s1">'0640'</span><span class="p">,</span>
    <span class="py">owner</span>   <span class="p">=&gt;</span> <span class="s1">'jenkins'</span><span class="p">,</span>
    <span class="py">group</span>   <span class="p">=&gt;</span> <span class="s1">'jenkins'</span><span class="p">,</span>
    <span class="py">content</span> <span class="p">=&gt;</span> <span class="nf">to_yaml</span><span class="p">(</span><span class="nv">$fog_hash</span><span class="p">),</span>
    <span class="kp">require</span> <span class="p">=&gt;</span> <span class="nc">User</span><span class="p">[</span><span class="s1">'jenkins'</span><span class="p">],</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="whats-next">What’s next?</h2>

<p>This is all great stuff… if it’s used. Next up is ensuring our Confluence page on deploying secrets is updated to help others utilize the Sensitive data type and the options provided by <code class="highlighter-rouge">node_encrypt</code>. After that it’s all about communication. Many of the people who work with secrets have been doing so long enough they probably don’t need to look at the directions anymore so I need to ensure they know that the process has been enhanced.</p>

<p><em>This article was originally posted at <a href="https://puppet.com/blog/my-journey-securing-sensitive-data-puppet-code">https://puppet.com/blog/my-journey-securing-sensitive-data-puppet-code</a>.</em></p>

<p><em>I am a senior site reliability engineer at Puppet.</em></p>


        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-08-15T14:50:40-04:00">August 15, 2018</time></p>
        
      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=My+journey+to+securing+sensitive+data+in+Puppet+code%20http%3A%2F%2Flocalhost%3A4000%2Fjekyll-beanbag%2Fprotecting-sensitive-data-in-puppet-code%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fjekyll-beanbag%2Fprotecting-sensitive-data-in-puppet-code%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Flocalhost%3A4000%2Fjekyll-beanbag%2Fprotecting-sensitive-data-in-puppet-code%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/jekyll-beanbag/dual-booting-macos-high-sierra-and-linux-mint/" class="pagination--pager" title="Dual Booting macOS High Sierra and Linux Mint
">Previous</a>
    
    
      <a href="/jekyll-beanbag/breaking-up-a-large-pull-request/" class="pagination--pager" title="Breaking up a large pull request
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/jekyll-beanbag/breaking-up-a-large-pull-request/" rel="permalink">Breaking up a large pull request
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Ever finished up all the changes for a pull request on GitHub and realized it was just too big to review easily or to reason about what’s going on? I had jus...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/jekyll-beanbag/dual-booting-macos-high-sierra-and-linux-mint/" rel="permalink">Dual Booting macOS High Sierra and Linux Mint
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  10 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">This is a step-by-step walkthrough for dual booting a MacBook Pro (Mid-2015 aka MacBookPro11,5) that already has macOS High Sierra on it with Linux Mint. The...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/jekyll-beanbag/gitlab-ci-and-chocolatey-server/" rel="permalink">GitLab CI and Chocolatey Server
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">If you are not familiar with chocolatey, its an awesome package manager, like apt or yum, for Windows. You can also host your own internal chocolatey feed an...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/jekyll-beanbag/the-road-to-puppet-5/" rel="permalink">The Road to Puppet 5
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Not long ago Puppet released version 5 to the open source world so, naturally, it was time to start updating all my projects to be compatible with it. The fi...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<input type="search" id="search" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term...">
    <div id="results" class="results"></div>
</div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://github.com/genebean" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://twitter.com/technicalissues" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://app.vagrantup.com/genebean" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Vagrant Boxes</a></li>
        
      
    

    <li><a href="/jekyll-beanbag/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2019 The Comfy Seat. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/jekyll-beanbag/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js" integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ" crossorigin="anonymous"></script>




<script src="/jekyll-beanbag/assets/js/lunr/lunr.min.js"></script>
<script src="/jekyll-beanbag/assets/js/lunr/lunr-store.js"></script>
<script src="/jekyll-beanbag/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
